
CREATE TABLE Device (
    device_id INT PRIMARY KEY,
    dname VARCHAR(50),
    type VARCHAR(30)
);

CREATE TABLE Room (
    room_id INT PRIMARY KEY,
    rname VARCHAR(50),
    floor INT
);

CREATE TABLE Usage_Log (
    log_id INT PRIMARY KEY,
    device_id INT,
    room_id INT,
    used_at DATETIME,
    duration INT, -- in minutes
    FOREIGN KEY (device_id) REFERENCES Device(device_id),
    FOREIGN KEY (room_id) REFERENCES Room(room_id)
);


Devices used more than 5 total hours





SELECT D.dname
FROM Device D
JOIN Usage_Log U ON D.device_id = U.device_id
GROUP BY D.device_id
HAVING SUM(U.duration) > 300;




(c) Total hours per room (using ROUND & SUM)



SELECT R.room_id, R.rname,
ROUND(SUM(U.duration) / 60, 2) AS total_hours
FROM Room R
JOIN Usage_Log U ON R.room_id = U.room_id
GROUP BY R.room_id;



Trigger: Prevent duration = 0





DELIMITER //

CREATE TRIGGER prevent_zero_duration
BEFORE INSERT ON Usage_Log
FOR EACH ROW
BEGIN
    IF NEW.duration = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Duration cannot be zero!';
    END IF;
END;
//

DELIMITER ;



Procedure: Delete logs older than a given date




DELIMITER //

CREATE PROCEDURE delete_logs_older(IN p_date DATE)
BEGIN
    DELETE FROM Usage_Log WHERE used_at < p_date;
END;
//

DELIMITER ;
