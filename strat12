
CREATE TABLE Customer (
    cust_id INT PRIMARY KEY,
    cname VARCHAR(50),
    age INT,
    gender CHAR(1)
);

CREATE TABLE Car (
    car_id INT PRIMARY KEY,
    model VARCHAR(50),
    rent_per_day NUMBER(10,2)
);

CREATE TABLE Rental (
    rental_id INT PRIMARY KEY,
    cust_id INT,
    car_id INT,
    rental_start DATE,
    rental_end DATE,
    FOREIGN KEY (cust_id) REFERENCES Customer(cust_id),
    FOREIGN KEY (car_id) REFERENCES Car(car_id)
);





(b) Find Customers Who Rented More Than 2 Cars in a Month




SELECT cname
FROM Customer C
WHERE cust_id IN (
    SELECT cust_id
    FROM Rental
    WHERE EXTRACT(MONTH FROM rental_start) = EXTRACT(MONTH FROM SYSDATE)
      AND EXTRACT(YEAR FROM rental_start) = EXTRACT(YEAR FROM SYSDATE)
    GROUP BY cust_id
    HAVING COUNT(car_id) > 2
);



(c) Use String Functions to Display Name in Uppercase and First 3 Letters of Car Model



SELECT UPPER(cname) AS Customer_Name,
       SUBSTR(model, 1, 3) AS Car_Model_Abbr
FROM Customer C
JOIN Rental R ON C.cust_id = R.cust_id
JOIN Car CA ON R.car_id = CA.car_id;



(d) Trigger to Stop Rental Insertion If Car Already Rented on Selected Dates






CREATE OR REPLACE TRIGGER prevent_car_double_rental
BEFORE INSERT ON Rental
FOR EACH ROW
DECLARE
    v_count INT;
BEGIN
    SELECT COUNT(*) INTO v_count
    FROM Rental
    WHERE car_id = :NEW.car_id
      AND :NEW.rental_start < rental_end
      AND :NEW.rental_end > rental_start;

    IF v_count > 0 THEN
        RAISE_APPLICATION_ERROR(
            -20100,
            'Car already rented for selected dates!'
        );
    END IF;
END;
/


(e) Stored Procedure to Update Car Rent







CREATE OR REPLACE PROCEDURE update_car_rent(
    p_car_id INT,
    p_new_rent NUMBER
)
IS
BEGIN
    UPDATE Car
    SET rent_per_day = p_new_rent
    WHERE car_id = p_car_id;

    COMMIT;
END;
/
